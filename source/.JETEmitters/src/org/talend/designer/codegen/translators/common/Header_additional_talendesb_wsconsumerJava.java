package org.talend.designer.codegen.translators.common;

import java.util.Vector;
import org.talend.designer.codegen.config.CodeGeneratorArgument;
import org.talend.core.model.process.ElementParameterParser;
import org.talend.core.model.process.INode;
import org.talend.core.model.process.IProcess;

public class Header_additional_talendesb_wsconsumerJava
{
  protected static String nl;
  public static synchronized Header_additional_talendesb_wsconsumerJava create(String lineSeparator)
  {
    nl = lineSeparator;
    Header_additional_talendesb_wsconsumerJava result = new Header_additional_talendesb_wsconsumerJava();
    nl = null;
    return result;
  }

  public final String NL = nl == null ? (System.getProperties().getProperty("line.separator")) : nl;
  protected final String TEXT_1 = "    @SuppressWarnings(\"serial\")" + NL + "    public static class GenericFaultInfoException extends org.apache.cxf.frontend.FaultInfoException {" + NL + "" + NL + "        private org.dom4j.Document faultInfo;" + NL + "" + NL + "        public GenericFaultInfoException(String arg0, javax.xml.transform.Source source) {" + NL + "            super(arg0);" + NL + "            try {" + NL + "                faultInfo = GenericConsumer.sourceToDocument(source);" + NL + "            } catch (Exception e) {" + NL + "                e.printStackTrace();" + NL + "            }" + NL + "        }" + NL + "" + NL + "        public Object getFaultInfo() {" + NL + "            return faultInfo;" + NL + "        }" + NL + "    }" + NL + "" + NL + "    static class GenericServiceClass {" + NL + "        public Object invoke(Object param) throws GenericFaultInfoException {" + NL + "            return null;" + NL + "        }" + NL + "    }" + NL + "" + NL + "    static class GenericConsumer {" + NL + "" + NL + "        private static final javax.xml.transform.TransformerFactory FACTORY = javax.xml.transform.TransformerFactory.newInstance();" + NL + "" + NL + "        private javax.xml.namespace.QName serviceQName;" + NL + "        private javax.xml.namespace.QName portQName;" + NL + "        private javax.xml.namespace.QName operationQName;" + NL + "        private boolean isRequestResponse;" + NL + "        private String soapAction;" + NL + "        private String address;" + NL + "        private String wsdlURL;" + NL + "" + NL + "        private java.util.Collection<org.apache.cxf.feature.Feature> esbFeatures;" + NL + "        private org.apache.cxf.Bus bus;" + NL + "" + NL + "        private String authType;" + NL + "        private String username;" + NL + "        private String password;" + NL + "" + NL + "        private String proxyServer;" + NL + "        private int proxyPort;" + NL + "        private String proxyUsername;" + NL + "        private String proxyPassword;" + NL + "" + NL + "        private long connectionTimeout;" + NL + "        private long receiveTimeout;" + NL + "" + NL + "        private boolean logMessages;" + NL + "" + NL + "        private java.util.Collection<org.apache.cxf.headers.Header> soapHeaders;" + NL + "" + NL + "        private Object correlationIDCallbackHandler;" + NL + "" + NL + "        private String correlationID;" + NL + "" + NL + "        public void setServiceQName(javax.xml.namespace.QName serviceQName) {" + NL + "            this.serviceQName = serviceQName;" + NL + "        }" + NL + "" + NL + "        public void setPortQName(javax.xml.namespace.QName portQName) {" + NL + "            this.portQName = portQName;" + NL + "        }" + NL + "" + NL + "        public void setOperationQName(javax.xml.namespace.QName operationQName) {" + NL + "            this.operationQName = operationQName;" + NL + "        }" + NL + "" + NL + "        public void setIsRequestResponse(boolean isRequestResponse) {" + NL + "            this.isRequestResponse = isRequestResponse;" + NL + "        }" + NL + "" + NL + "        public void setSoapAction(String soapAction) {" + NL + "            this.soapAction = soapAction;" + NL + "        }" + NL + "" + NL + "        public void setAddress(String address) {" + NL + "            this.address = address;" + NL + "        }" + NL + "" + NL + "        public void setWsdlURL(String wsdlURL) {" + NL + "            this.wsdlURL = wsdlURL;" + NL + "        }" + NL + "" + NL + "        public void setEsbFeatures(" + NL + "                java.util.Collection<org.apache.cxf.feature.Feature> esbFeatures) {" + NL + "            this.esbFeatures = esbFeatures;" + NL + "        }" + NL + "" + NL + "        public void setBus(org.apache.cxf.Bus bus) {" + NL + "            this.bus = bus;" + NL + "        }" + NL + "" + NL + "        public void setAuthType(String authType) {" + NL + "            this.authType = authType;" + NL + "        }" + NL + "" + NL + "        public void setUsername(String username) {" + NL + "            this.username = username;" + NL + "        }" + NL + "" + NL + "        public void setPassword(String password) {" + NL + "            this.password = password;" + NL + "        }" + NL + "" + NL + "        public void setProxyServer(String proxyServer) {" + NL + "            this.proxyServer = proxyServer;" + NL + "        }" + NL + "" + NL + "        public void setProxyPort(int proxyPort) {" + NL + "            this.proxyPort = proxyPort;" + NL + "        }" + NL + "" + NL + "        public void setProxyUsername(String proxyUsername) {" + NL + "            this.proxyUsername = proxyUsername;" + NL + "        }" + NL + "" + NL + "        public void setProxyPassword(String proxyPassword) {" + NL + "            this.proxyPassword = proxyPassword;" + NL + "        }" + NL + "" + NL + "        public void setConnectionTimeout(long connectionTimeout) {" + NL + "            this.connectionTimeout = connectionTimeout;" + NL + "        }" + NL + "" + NL + "        public void setReceiveTimeout(long receiveTimeout) {" + NL + "            this.receiveTimeout = receiveTimeout;" + NL + "        }" + NL + "" + NL + "        public void setLogMessages(boolean logMessages) {" + NL + "            this.logMessages = logMessages;" + NL + "        }" + NL + "" + NL + "        public void setSoapHeaders(java.util.Collection<org.apache.cxf.headers.Header> soapHeaders) {" + NL + "            this.soapHeaders = soapHeaders;" + NL + "        }" + NL + "" + NL + "        public void setCorrelationIDCallbackHandler(Object correlationIDCallbackHandler) {" + NL + "            this.correlationIDCallbackHandler = correlationIDCallbackHandler;" + NL + "        }" + NL + "" + NL + "        public String getCorrelationID() {" + NL + "            return correlationID;" + NL + "        }" + NL + "" + NL + "        public org.dom4j.Document invoke(org.dom4j.Document doc) throws GenericFaultInfoException, org.apache.cxf.interceptor.Fault {" + NL + "            org.apache.cxf.frontend.ClientFactoryBean clientFactory = new org.apache.cxf.frontend.ClientFactoryBean();" + NL + "            clientFactory.getServiceFactory().getServiceConfigurations().add(0, new org.apache.cxf.service.factory.AbstractServiceConfiguration() {" + NL + "                @Override" + NL + "                public Boolean isOperation(java.lang.reflect.Method method) {" + NL + "                    return \"invoke\".equals(method.getName());" + NL + "                }" + NL + "                @Override" + NL + "                public javax.xml.namespace.QName getOperationName(org.apache.cxf.service.model.InterfaceInfo service, java.lang.reflect.Method method) {" + NL + "                    return operationQName;" + NL + "                }" + NL + "                @Override" + NL + "                public Boolean hasOutMessage(java.lang.reflect.Method m) {" + NL + "                    return isRequestResponse;" + NL + "                }" + NL + "                @Override" + NL + "                public String getAction(org.apache.cxf.service.model.OperationInfo op, java.lang.reflect.Method method) {" + NL + "                    return soapAction;" + NL + "                }" + NL + "                @Override" + NL + "                public Boolean isWrapped() {" + NL + "                    return Boolean.FALSE;" + NL + "                }" + NL + "                @Override" + NL + "                public javax.xml.namespace.QName getFaultName(org.apache.cxf.service.model.InterfaceInfo service, org.apache.cxf.service.model.OperationInfo o," + NL + "                        Class<?> exClass, Class<?> beanClass) {" + NL + "                    for (org.apache.cxf.service.model.FaultInfo fi : o.getFaults()) {" + NL + "                        for (org.apache.cxf.service.model.MessagePartInfo mpi : fi.getMessageParts()) {" + NL + "                            return mpi.getConcreteName();" + NL + "                        }" + NL + "                    }" + NL + "                    return null;" + NL + "                }" + NL + "            });" + NL + "            if (null != wsdlURL) {" + NL + "                clientFactory.setWsdlURL(wsdlURL);" + NL + "            }" + NL + "            clientFactory.setServiceClass(GenericServiceClass.class);" + NL + "" + NL + "            clientFactory.setServiceName(serviceQName);" + NL + "            clientFactory.setEndpointName(portQName);" + NL + "" + NL + "            clientFactory.setAddress(address);" + NL + "            clientFactory.getProperties(true).put(\"soap.no.validate.parts\", Boolean.TRUE);" + NL + "" + NL + "            if (null != bus) {" + NL + "                clientFactory.setBus(bus);" + NL + "            }" + NL + "            if (null != esbFeatures) {" + NL + "                clientFactory.getFeatures().addAll(esbFeatures);" + NL + "            }" + NL + "            if (logMessages) {" + NL + "                clientFactory.getFeatures().add(new org.apache.cxf.feature.LoggingFeature());" + NL + "            }" + NL + "            if (null != correlationIDCallbackHandler) {" + NL + "                clientFactory.getProperties(true).put(\"correlation-id.callback-handler\", correlationIDCallbackHandler);" + NL + "            }" + NL + "" + NL + "            org.apache.cxf.endpoint.Client client = clientFactory.create();" + NL + "            client.getEndpoint().getService().setDataBinding(new org.apache.cxf.databinding.source.SourceDataBinding());" + NL + "" + NL + "            org.apache.cxf.transport.http.HTTPConduit conduit = (org.apache.cxf.transport.http.HTTPConduit) client.getConduit();" + NL + "            if (\"BASIC\".equals(authType)) {" + NL + "                org.apache.cxf.configuration.security.AuthorizationPolicy authorizationPolicy = new org.apache.cxf.configuration.security.AuthorizationPolicy();" + NL + "                authorizationPolicy.setUserName(username);" + NL + "                authorizationPolicy.setPassword(password);" + NL + "                authorizationPolicy.setAuthorizationType(\"Basic\");" + NL + "                conduit.setAuthorization(authorizationPolicy);" + NL + "            } else if (\"DIGEST\".equals(authType)) {" + NL + "                org.apache.cxf.configuration.security.AuthorizationPolicy authorizationPolicy = new org.apache.cxf.configuration.security.AuthorizationPolicy();" + NL + "                authorizationPolicy.setUserName(username);" + NL + "                authorizationPolicy.setPassword(password);" + NL + "                authorizationPolicy.setAuthorizationType(\"Digest\");" + NL + "                conduit.setAuthorization(authorizationPolicy);" + NL + "            } else if (\"TOKEN\".equals(authType)) {" + NL + "                java.util.Map<String, Object> wssProps = new java.util.HashMap<String, Object>();" + NL + "                wssProps.put(org.apache.ws.security.handler.WSHandlerConstants.ACTION, org.apache.ws.security.handler.WSHandlerConstants.USERNAME_TOKEN);" + NL + "                wssProps.put(org.apache.ws.security.handler.WSHandlerConstants.USER, username);" + NL + "                wssProps.put(org.apache.ws.security.handler.WSHandlerConstants.PASSWORD_TYPE, org.apache.ws.security.WSConstants.PW_TEXT);" + NL + "                wssProps.put(org.apache.ws.security.handler.WSHandlerConstants.PW_CALLBACK_REF," + NL + "                        new javax.security.auth.callback.CallbackHandler() {" + NL + "                            public void handle(javax.security.auth.callback.Callback[] callbacks)" + NL + "                                    throws java.io.IOException, javax.security.auth.callback.UnsupportedCallbackException {" + NL + "                                org.apache.ws.security.WSPasswordCallback pc = (org.apache.ws.security.WSPasswordCallback) callbacks[0];" + NL + "                                pc.setPassword(password);" + NL + "                            }" + NL + "                        });" + NL + "                client.getEndpoint()" + NL + "                        .getOutInterceptors().add(new org.apache.cxf.ws.security.wss4j.WSS4JOutInterceptor(wssProps));" + NL + "            }" + NL + "" + NL + "            org.apache.cxf.transports.http.configuration.HTTPClientPolicy httpClientPolicy = conduit.getClient();" + NL + "            if (null != proxyServer) {" + NL + "                httpClientPolicy.setProxyServerType(org.apache.cxf.transports.http.configuration.ProxyServerType.HTTP);" + NL + "                httpClientPolicy.setProxyServer(proxyServer);" + NL + "                httpClientPolicy.setProxyServerPort(proxyPort);" + NL + "            }" + NL + "            if (null != proxyUsername && !\"\".equals(proxyUsername)) {" + NL + "                org.apache.cxf.configuration.security.ProxyAuthorizationPolicy proxyAuthorization = new org.apache.cxf.configuration.security.ProxyAuthorizationPolicy();" + NL + "                proxyAuthorization.setUserName(proxyUsername);" + NL + "                proxyAuthorization.setPassword(proxyPassword);" + NL + "                conduit.setProxyAuthorization(proxyAuthorization);" + NL + "            }" + NL + "            httpClientPolicy.setConnectionTimeout(connectionTimeout);" + NL + "            httpClientPolicy.setReceiveTimeout(receiveTimeout);" + NL + "" + NL + "            if (null != soapHeaders) {" + NL + "                client.getRequestContext().put(org.apache.cxf.headers.Header.HEADER_LIST, soapHeaders);" + NL + "            }" + NL + "" + NL + "            try {" + NL + "                Object[] results = client.invoke(operationQName, new org.dom4j.io.DocumentSource(doc));" + NL + "                correlationID = (String) client.getResponseContext().get(\"CorrelationID\");" + NL + "                if (results != null && results.length > 0) {" + NL + "                    return sourceToDocument((javax.xml.transform.Source) results[0]);" + NL + "                }" + NL + "            } catch (GenericFaultInfoException e) {" + NL + "                throw e;" + NL + "            } catch (org.apache.cxf.interceptor.Fault e) {" + NL + "                throw e;" + NL + "            } catch (Exception e) {" + NL + "                throw new org.apache.cxf.interceptor.Fault(e);" + NL + "            }" + NL + "            return null;" + NL + "        }" + NL + "" + NL + "        public static org.dom4j.Document sourceToDocument(javax.xml.transform.Source source) throws Exception{" + NL + "            java.io.ByteArrayOutputStream os = new java.io.ByteArrayOutputStream();" + NL + "            FACTORY.newTransformer().transform(source, new javax.xml.transform.stream.StreamResult(os));" + NL + "            return new org.dom4j.io.SAXReader().read(new java.io.ByteArrayInputStream(os.toByteArray()));" + NL + "        }" + NL + "" + NL + "    }" + NL;
  protected final String TEXT_2 = NL;
  protected final String TEXT_3 = NL + "    private Object wrapPayload(Object payload, Object customProperties) {" + NL + "        java.util.Map<String, Object> outputWrapped = new java.util.HashMap<String, Object>();" + NL + "        outputWrapped.put(\"PAYLOAD\", payload);" + NL + "        if (null != customProperties) {" + NL + "            outputWrapped.put(\"SAM-PROPS\", customProperties);" + NL + "        }" + NL + "        return outputWrapped;" + NL + "    }";
  protected final String TEXT_4 = NL;

  public String generate(Object argument)
  {
    final StringBuffer stringBuffer = new StringBuffer();
    
CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
Vector v = (Vector) codeGenArgument.getArgument();
IProcess process = (IProcess) v.get(0);

boolean actAsProvider = !process.getNodesOfType("tESBProviderRequest").isEmpty();
boolean actAsConsumer = !process.getNodesOfType("tESBConsumer").isEmpty();
if (actAsConsumer) { 

    stringBuffer.append(TEXT_1);
     } // end if (actAsConsumer) 
    stringBuffer.append(TEXT_2);
     if (actAsProvider || actAsConsumer) {
    stringBuffer.append(TEXT_3);
     } 
    stringBuffer.append(TEXT_4);
    return stringBuffer.toString();
  }
}
